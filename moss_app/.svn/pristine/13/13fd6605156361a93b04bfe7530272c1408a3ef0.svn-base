var configDebugPrefix = "[config.js] : ";
var db = 0;

var getStartPage = "";
var getAutoLogin = "";
var getVersion = "";

//조회
function getConfigInfoResultSet() {
	db.transaction(querySelectConfigInfoDB, errorConfigInfoCB);
}

function querySelectConfigInfoDB(tx) {
	tx.executeSql('SELECT startPage, autoLoginYN, version FROM MOSS_USERINFO', [], selectConfigInfoSuccess, errorConfigInfoCB);
}

function selectConfigInfoSuccess(tx, results) {
	getStartPage = results.rows.item(0).startPage;
	getAutoLogin = results.rows.item(0).autoLoginYN;
	getVersion = results.rows.item(0).version;
	
	$("#version").text(getVersion);
	$("#config_autoLogin").val(getAutoLogin).slider( "refresh" );
	$("#config_startPage").val(getStartPage).selectmenu( "refresh" );

	console.log(configDebugPrefix + "============ 설정 정보 ============");
	console.log(configDebugPrefix + "시작페이지 : " + getStartPage);
	console.log(configDebugPrefix + "AutoLogin : " + getAutoLogin);
	console.log(configDebugPrefix + "버전 : " + getVersion);
}

function errorConfigInfoCB(err) {
	console.log(configDebugPrefix + "============ 사용자 설정 : update error ============");
}

function checkField(value) {
	console.log(configDebugPrefix + "============ 설정 정보 파라미터 ============");
	console.log(configDebugPrefix + value);
	
	updateConfigInfo();
}

//업데이트
function updateConfigInfo() {
	db.transaction(queryUpdateConfigInfoDB, errorConfigInfoCB);
}

function queryUpdateConfigInfoDB(tx) {
	var userAutoLogin = $("#config_autoLogin").val();
	var userStartPage = $("#config_startPage").val();
	
//	DB field
//	(userID, userPW, startPage, autoLoginYN, locationYN, pushYN, version)
	var sql = "UPDATE MOSS_USERINFO SET startPage='"+ userStartPage +"', autoLoginYN='"+ userAutoLogin +"' where version = '"+userVersion+"';";
	console.log(configDebugPrefix + "SQL = " + sql);
	
	tx.executeSql(sql, [], updateConfigInfoSuccess, errorConfigInfoCB);
}

function updateConfigInfoSuccess(tx, results) {
	console.log(configDebugPrefix + "============ 사용자 설정 : update Success ============");
}

$(document).on("pagebeforecreate", "#page_config" ,function(event) {
	if (!db) {
		db = window.openDatabase("Database", "1.0", "myDb", 200000);
	}
//	// iOS의 경우 KT-Console 메뉴 Disable 이미지 사용
//	if (deviceInfo != "Android") {
//		$("#panel_img_ktConsole").attr("src", "../img/menu_remote_d.png");
//	}
});

$(document).on("pagebeforeshow", "#page_config" ,function(event) {
	getConfigInfoResultSet();
});

$(document).on("pageshow", "#page_config", function(event) {
	// menuPanel 별도의 스크롤 생성
	var myPanelScroll = new iScroll('menuPanel', {bounce: false});
	//	menuPanel open 시 스크롤 이벤트 제어
	$("#menuPanel").panel({
		  beforeopen: function( event, ui ) {
			if (deviceInfo != "Android") {
				$("#panel_img_ktConsole").attr("src", "../img/menu_remote_d.png");
			}
		  }
	});
	$("#menuPanel").panel({
		open : function(event, ui) {
			myPanelScroll.refresh();
		}
	});
	// 스크롤 이벤트 발생 시 menuPanel 닫기
	$(window).on('scroll', function () {
		$("#menuPanel").panel("close");
	});
});