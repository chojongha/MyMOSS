var transOfficeDetail_debugPrefix = "[transOffice_detail.js] : "; 
var workplaceSN="";

//국사 상세 페이지 출력
function showTransOffice_detail(){
	
	$.mobile.loading( "show", {
        text: "로딩중...",
        textVisible: true,
        theme: "a",
        html: "" 
	}); 
	
	//국사 시퀀스 넘버 받기
	workplaceSN=Request("workplaceSeqNum");
	
	console.log(transOfficeDetail_debugPrefix + "넘어온 시퀀스넘버 = " + workplaceSN);
	
	$.ajax({ 
		url: url + "MossWorkplaceDetail",
		type: "post",
		timeout: 10*1000,
		dataType: "json",
		data: {workplaceSeqNum:workplaceSN},		
		success: function(result){
			var bodyData = result.body;
			var headerData = result.header;
			var transOfficeTB = "";
			
			if(headerData.result != 0){
				transOfficeTB = "<li data-icon='false'> "+
								"<a href='#'>" +
								"<center><h2>정보가 없습니다</h2></center>" +     
								"</a>" +
								"</li>";
				$.mobile.hidePageLoadingMsg();
			}else{
				$.each(bodyData, function(key, val){
					$.each(val, function(key, val) {
	                    console.log(transOfficeDetail_debugPrefix + key + " : " + val);
	                });					
					//테이블 생성
					transOfficeTB = '<table id="table_detail">'+
									'<tr>'+									
									'</tr>'+
									'<tr>'+
									'<td align="left" colspan="2" bgcolor="#5d5d5d"><font color="#ffffff">사업장정보</font></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">사업장유형</td>'+
									'<td align="left" id="TO_info" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">모국명</td>'+
									'<td align="left" id="TO_office" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">사업장명</td>'+
									'<td align="left" id="TO_area" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">사진정보</td>'+
									'<td align="left" id="TO_pic" bgcolor="#ffffff">&nbsp;사진보기&nbsp;<a href="#TO_img" data-rel="popup" data-position-to="window" data-transition="fade"><img class="popphoto" src="../img/pictures.png"></a></td>'+
									'</tr>'+
									
									//국사 사진 첨부(따로 첨부함. 화면이 깨지기 때문: 사진이미리떠버림. 클릭없이)
//									'<div data-role="popup" id="TO_img" data-overlay-theme="a" data-theme="d" data-corners="false">'+
//									'<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a><img id="imgSrc" class="popphoto" src="../img/transOfficePhoto.png" style="max-height:512px;" alt="국사사진">'+
//									'</div>'+
									
									'<tr>'+
									'<td align="left" colspan="2" bgcolor="#5d5d5d"><font color="#ffffff">위치정보</font></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">주소</td>'+
									'<td align="left" id="TO_addr" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">상세주소</td>'+
									'<td align="left" id="TO_detailAddr" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">위도</td>'+
									'<td align="left" id="TO_lati" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">경도</td>'+
									'<td align="left" id="TO_longi" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" colspan="2" bgcolor="#5d5d5d"><font color="#ffffff">출입정보</font></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">제한시간</td>'+
									'<td align="left" id="TO_timeLimit" bgcolor="#ffffff">'+nullCheck(val.ENTERLIMITEDTIME)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">출입방법</td>'+
									'<td align="left" id="TO_visitRule" bgcolor="#ffffff">'+nullCheck(val.ENTERMETHOD)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">건물관리자</td>'+
									'<td align="left" id="TO_manager" bgcolor="#ffffff">'+nullCheck(val.ENTERMANAGER)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">연락처 1</td>'+
									'<td align="left" id="TO_tel" bgcolor="#ffffff">'+nullCheck(val.ENTERTEL1)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">연락처 2</td>'+
									'<td align="left" id="TO_manaPhone" bgcolor="#ffffff">'+nullCheck(val.ENTERTEL2)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" colspan="2" bgcolor="#5d5d5d"><font color="#ffffff">시설정보</font></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">시설정보 1</td>'+
									'<td align="left" id="TO_equiHistory1" bgcolor="#ffffff">'+nullCheck(val.EQUIPMENTMEMO1)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">시설정보 2</td>'+
									'<td align="left" id="TO_equiHistory2" bgcolor="#ffffff">'+nullCheck(val.EQUIPMENTMEMO2)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">추가정보</td>'+
									'<td align="left" id="TO_equiHistory3" bgcolor="#ffffff">'+nullCheck(val.ADDINFO)+'</td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" colspan="2" bgcolor="#5d5d5d"><font color="#ffffff">관리정보</font></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">관리 NSC</td>'+
									'<td align="left" id="TO_jurisCenter" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'<tr>'+
									'<td align="left" width="30%" bgcolor="#ffffff">관리 팀</td>'+
									'<td align="left" id="TO_jurisTeam" bgcolor="#ffffff"></td>'+
									'</tr>'+
									'</table>';

					//테이블 삽입								
					$("#table_transOfficeDetail").html(transOfficeTB); 					
					//데이터 세팅
					var i=val.WORKPLACETYPE;
					$('#TO_info').text(officeName[i]);
					$('#TO_office').text(val.POFFICENAMESCODE);
					$('#TO_area').text(val.WORKPLACENAME);
					$('#TO_addr').text(val.ADDR);
					$('#TO_detailAddr').text(val.ADDRDTL);
					$('#TO_lati').text(val.LATITUDE);
					$('#TO_longi').text(val.LONGITUDE);
					$('#TO_jurisCenter').text(val.MANAGENSC);
					$('#TO_jurisTeam').text(val.MANAGETEAM); 
																				
					$.mobile.hidePageLoadingMsg();
				});
			}	
		},
		error: function(jqXHR, textStatus, errorThrown) {
			console.log(transOfficeDetail_debugPrefix + "국사상세정보 출력 에러 : " + jqXHR.status);
	        console.log(transOfficeDetail_debugPrefix + "국사상세정보 출력 에러 : " + jqXHR.responseText);
			console.log(transOfficeDetail_debugPrefix + "국사상세정보 출력 에러 : " + errorThrown);
	    }
	});
}

//국사 사진보기
function showTransOfficeImg(){
	$.ajax({
		url: url + "MossWorkplaceDetail",
		type: "post",
		timeout: 10*1000,
		dataType: "json",
		data: {workplaceSeqNum:workplaceSN},
		
		success: function(result){
			var bodyData = result.body;
			var headerData = result.header;
			var imgPop="";
			
			if(headerData.result != 0){
				console.log(transOfficeDetail_debugPrefix + "사진 데이터 없음");
			}
			
			$.each(bodyData, function(key, val){								 
				imgPop = '<div data-role="popup" id="TO_img" data-overlay-theme="a" data-theme="d" data-corners="false">'+
					     '<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a><img id="imgSrc" class="popphoto" src="../img/transOfficePhoto.png" style="max-height:512px;" alt="국사사진">'+		
					     '</div>';
				
						//$("#imgSrc").attr('src', 'srcImage.jpg');
				
				console.log("사진파일 :::::: " +val.FILEBINARY);
							
//				if(val.FILEBINARY == null){
//					$("#TO_pic").text("  사진없음 ");
//				}else{
					$("#table_transOfficeDetail").append(imgPop).trigger("create");	
//				}									
			});
		},
		error: function(jqXHR, textStatus, errorThrown) {
			console.log(transOfficeDetail_debugPrefix + "국사사진 출력 에러 : " + jqXHR.status);
	        console.log(transOfficeDetail_debugPrefix + "국사사진 출력 에러 : " + jqXHR.responseText);
			console.log(transOfficeDetail_debugPrefix + "국사사진 출력 에러 : " + errorThrown);
	    }
	});
}

$(document).on("pagebeforeshow","#page_transOffice_detail",function(event){
////	showTransOffice_detail();
});

$(document).on("pageshow","#page_transOffice_detail",function(event){
	showTransOffice_detail();
	showTransOfficeImg();
});
$(document).on("pageshow","#page_map_transOffice_detail",function(event){	
	showTransOffice_detail();
	showTransOfficeImg();
});
