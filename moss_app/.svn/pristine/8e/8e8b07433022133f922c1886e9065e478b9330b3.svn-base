var transOffice_debugPrefix = "[transOffice.js] : ";
var officeSel="";

//셀렉트박스 생성
function makeThreeSel(){
	
	console.log("국사페이지 진입");
	
	var ThreeSel="";
	
	$.ajax({
		url: url + "MossCode",
		type: "post",
		timeout: 10*1000,
		dataType: "json",
		data:{category:workplacetype},
		success: function(result){
			var bodyData = result.body;
			var headerData = result.header;
			
			if(headerData.result != 0){
				console.log(transOffice_debugPrefix + "작업유형데이터 없음");
			}else{//생성
				$.each(bodyData, function(key,val){
					ThreeSel += "<option value='" + val.CODE + "'>" + val.CODEVALUE + "</option>";
				});
				//삽입
				$('#ThreeField').append(ThreeSel).trigger("create").selectmenu( "refresh" );
			}
		}
	});
	
	if(serCode.length > 0){
		//생성
		for(var i=0; i<serCode.length; i++){																			
			officeSel += "<option value='" + serCode[i] + "'>" + serName[i] + "</option>";			
		}
		//삽입
		$('#officeField').append(officeSel).trigger("create").selectmenu( "refresh" );		
	}else{
		//생성
		officeSel = '<option value="no">작업장없음</option>';
		//삽입
		$('#officeField').html(officeSel).trigger("create").selectmenu( "refresh" ); 
	}
}

//검색기능
function filter(){
	var value = $('#word').val();	
	var valueUp = $('#word').val().toUpperCase(); //toUpperCase : 검색어를 대문자로 전환
	$('#listview > li').hide();
	$("#listview > li:contains('"+value+"')").show();
	$("#listview > li:contains('"+valueUp+"')").show();
}

//셀렉트박스 선택을 통해 국사 리스트불러오기
function showOfficeList(){
	// 페이지가 보여지면서 로더를 보여준다.
	$.mobile.loading( "show", {
		  text: "리스트를 읽어오는 중 입니다.",
		  textVisible: true,
		  theme: "a",
		  html: ""
	});

	//선택된 작업장 읽어오기
	var officeId=$("#officeField > option:selected").val();
	
	console.log(transOffice_debugPrefix + "선택된 작업장 ::: " + officeId);
	
	//국사 리스트생성
	$.ajax({
		url: url + "ManualList",
		type: "post",
		timeout: 10*1000,
		dataType: "json",
		data:{serviceid:officeId},
		success: function(result){ 
			var bodyData = result.body;
			var headerData = result.header;
			var officeLi = "";
		
		if(headerData.result != 0){
			officeLi = "<li data-icon='false'> "+
					   "<a href='#'>" +
					   "<center><h2>정보가 없습니다. 작업장을 선택하세요.</h2></center>" +     
					   "</a>" +
					   "</li>";
		}
		else{
			$.each(bodyData, function(key, val){	
					officeLi += "<li data-icon='false'>" +
								"<a href='alarmList_noti_detail_manual_detail.html?manualSeqNum="+val.MANUALSEQNUM+"'>" +	
								"<div class='listContent'>" +
								"<h2>"+ val.SUBJECT +"</h2>" +
								"<p style='display:inline-block; float:left'>"+ val.WRITEDATE +"</p>" +
                                "<p style='display:inline-block; float:right'>"+  val.WRITERNAME + "</p>" +
                                "</div>" +
                                "</a>" +
                                "</li>";										
			});
		}
		//국사 리스트 삽입
		$('#listview').html(officeLi).listview("refresh");
		$.mobile.hidePageLoadingMsg();		
		},
		error: function(jqXHR, textStatus, errorThrown){
			console.log(transOffice_debugPrefix + "국사리스트 출력 에러 : " + jqXHR.status);
			console.log(transOffice_debugPrefix + "국사리스트 출력 에러 : " + jqXHR.responseText);
			console.log(transOffice_debugPrefix + "국사리스트 출력 에러 : " + errorThrown);		
		} 
	});
}

$(document).on("pageshow","#page_transOffice", function(event){
	makeThreeSel();
//	showOfficeList();
});


//$(document).on("pageshow","#page_transOffice", function(event){
//		
//	$("#btn_refresh").click(function () {
//		$("#listview").empty();
//
//		showOfficeList();
//	});
//});