var manualList_debugPrefix = "[board_manual.js] : ";

//라디오버튼, 셀렉트박스 생성 및 연결
function connect_radio_select(){
	
	$.ajax({		
		url: url+"ServiceList",
		type: "post",
		timeout: 10*1000,
		dataType: "json",		
		success: function(result){
			var bodyData=result.body;
			var manualRa="";
			var manualSel="";
			
			if(bodyData.length > 0){
				$.each(bodyData, function(key,val){
					manualRa += "<input type='radio' name='manual' data-theme='d' data-iconpos='right' id='" + val.CD_NM + "' value='" + val.CD + "' checked=''>" +
								 "<label for='" + val.CD_NM + "'>"+val.CD_NM+"</label>\n";
					
					manualSel += "<option value='"+val.CD+"'>"+val.CD_NM+"</option>";
					
				});
			}else{
				manualRa = "<input type='radio' name='manual' data-theme='d' data-iconpos='right' id='not' value='not' checked=''>" +
						   "<label for='not'>데이터없음</label>\n";
				manualSel = '<option value="no">없음</option>';
			}
			//라디오버튼생성
			$('#manualRa-controlgroup').html(manualRa).trigger("create");
			//셀렉트박스 생성			
			$('#manualField').append(manualSel).trigger("create").selectmenu( "refresh" );

			//라디오버튼, 셀렉트박스 연결		
			var choice = getParam("checked");
			$("#manualField").val(choice).selectmenu( "refresh" );
			
			var serviceId=$("#manualField > option:selected").val();
			
			console.log(manualList_debugPrefix + "라디오버튼을 통해 선택된 값 : " + serviceId);
			
			$.ajax({
				url: url + "ManualList",
				type: "post",
				timeout: 10*1000,
				dataType: "json",
				data:{serviceid:serviceId},
				success: function(result){ 
					var bodyData = result.body;
					var manualLi = "";
					
					if(bodyData.length > 0){
						$.each(bodyData, function(key, val){					
								manualLi += "<li data-icon='false'>" +
												 "<a href='board_manual_detail.html?manualSeqNum="+val.MANUALSEQNUM+"'>" +										 
													"<table id='dynamicList'>" +
														"<tr>" +
															"<td class='dynamicTable_td'><h2 style='display:inline-block;'>"+ val.SUBJECT +"</h2></td>" +
														"</tr>" +
														"<tr>" +
															"<td class='dynamicTable_td'>"+ val.WRITEDATE +"</td>" +
														"</tr>" +
														"<tr>" +
															"<td class='dynamicTable_td' align='right'>"+ val.WRITERNAME +"</td>" +
														"</tr>" +
													"</table>" +
												"</a>" +
										    "</li>";				
						});
					}else{
						manualLi = "<li data-icon='false'> "+
					    		   "	<a href='#'>" +
					    		   "		<center><h2>데이터가 존재하지 않습니다.</h2></center>" +
					    		   "	</a>" +
					    		   "</li>";
					}
					$('#listview').html(manualLi).listview("refresh");
					$.mobile.hidePageLoadingMsg();
				},
				error: function(jqXHR, textStatus, errorThrown){
					console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + jqXHR.status);
			        console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + jqXHR.responseText);
					console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + errorThrown);
				} 
			});
		},
		error: function(jqXHR, textStatus, errorThrown){
			console.log(manualList_debugPrefix + "라디오버튼, 셀렉트박스 출력 에러 : " + jqXHR.status);
	        console.log(manualList_debugPrefix + "라디오버튼, 셀렉트박스 출력 에러 : " + jqXHR.responseText);
			console.log(manualList_debugPrefix + "라디오버튼, 셀렉트박스 출력 에러 : " + errorThrown);
		}
		
		
	});
}

//라디오 버튼 선택후 확인 클릭시 파라미터 전송
function SendParameter(){
	
	var isChecked=$(":input:radio[name=manual]:checked").val();
	$.mobile.changePage('board_manual.html?checked='+isChecked);	
}

//get parameter 파라미터 받기
	var getParam = function(key){
	    var _parammap = {};
	    document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
	        function decode(s) {
	            return decodeURIComponent(s.split("+").join(" "));
	        }

	        _parammap[decode(arguments[1])] = decode(arguments[2]);
	    });

	    return _parammap[key];
	};

//검색기능
function filter(){
	var value = $('#word').val().toUpperCase();	//toUpperCase : 검색어를 대문자로 전환
	$('#listview > li').hide();
	$("#listview > li:contains('"+value+"')").show();
}

//업무매뉴얼 리스트불러오기
function showManualList(){
	// 페이지가 보여지면서 로더를 보여준다.
	$.mobile.loading( "show", {
		  text: "리스트를 읽어오는 중 입니다.",
		  textVisible: true,
		  theme: "a",
		  html: ""
	});
	
	var serviceId=$("#manualField > option:selected").val();

	console.log(manualList_debugPrefix + "선택된 값 : " + serviceId);
	
	$.ajax({
		url: url + "ManualList",
		type: "post",
		timeout: 10*1000,
		dataType: "json",
		data:{serviceid:serviceId},
		success: function(result){ 
			var bodyData = result.body;
			var manualLi = "";
			
			if(bodyData.length > 0){
				$.each(bodyData, function(key, val){					
						manualLi += "<li data-icon='false'>" +
										 "<a href='board_manual_detail.html?manualSeqNum="+val.MANUALSEQNUM+"'>" +										 
											"<table id='dynamicList'>" +
												"<tr>" +
													"<td class='dynamicTable_td'><h2 style='display:inline-block;'>"+ val.SUBJECT +"</h2></td>" +
												"</tr>" +
												"<tr>" +
													"<td class='dynamicTable_td'>"+ val.WRITEDATE +"</td>" +
												"</tr>" +
												"<tr>" +
													"<td class='dynamicTable_td' align='right'>"+ val.WRITERNAME +"</td>" +
												"</tr>" +
											"</table>" +
										"</a>" +
								    "</li>";				
				});
			}else{
				manualLi = "<li data-icon='false'> "+
			    		   "	<a href='#'>" +
			    		   "		<center><h2>데이터가 존재하지 않습니다.</h2></center>" +
			    		   "	</a>" +
			    		   "</li>";
			}
			
			if(serviceId=="select"){
				manualLi = "<li data-icon='false'> "+
	    		   "	<a href='#'>" +
	    		   "		<center><h2>분야를 선택하세요.</h2></center>" +
	    		   "	</a>" +
	    		   "</li>";
			}
			
			$('#listview').html(manualLi).listview("refresh");
			$.mobile.hidePageLoadingMsg();
		},
		error: function(jqXHR, textStatus, errorThrown){
			console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + jqXHR.status);
	        console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + jqXHR.responseText);
			console.log(manualList_debugPrefix + "매뉴얼리스트 출력 에러 : " + errorThrown);
		} 
	});
}

$(document).on("pagebeforeshow","#page_manualList", function(event){ 
//	connect_radio_select();
//	showManualList();
});

$(document).on("pageshow","#page_manualList", function(event){
	connect_radio_select(); //라디오버튼 선택후 셀렉트 박스 자동 선택되어지기 위함.(pageshow에도 있어야 보여짐) but,두번쓰면 append이기때문에 중복으로 씌여짐/고민해볼것:pagebeforeshow부분에 아무것도 설정안해주면 되는듯. 임시방편
	showManualList();
});